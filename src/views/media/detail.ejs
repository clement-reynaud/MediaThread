<input type="hidden" id="entryId" value="<%= entry.id %>">

<div class="entry-detail" style="<%= entry.is_draft ? "outline: 5px dotted var(--input-border);" : ""%>">
  <div>
    <img class="thumbnail" src="/<%= entry.image_path %>" alt="">
  </div>

  <div>
    <div style="max-width: 10%; font-style: italic;"><%= entry.is_draft ? "[Brouillon]" : "" %></div>
    <h1 style="max-width: 80%;"><%= entry.title %></h1>
    <small><%= entry.created_at.toLocaleString("fr-FR") %> | <%= t("by") %> <span style="color: blue;"><%= entry.user.username %></span></small>
    <% if (entry.tags?.length) { %>
      <div class="entry-tags">
        <% entry.tags.forEach(tag => { %>
          <span class="tag" style="background-color:<%= tag.color %>"><%= tag.name %></span>
        <% }) %>
      </div>
    <% } %>
  </div>
  
  <div style="display: flex; flex-direction: row; justify-content: center;">
    <div class="stats-container" style=" margin: 20px;">
        <!-- <% if (entry.tags?.length) { %>
          <div class="stat-card">
            <div class="stat-number"><%= entry.tags.length %></div>
            <div class="stat-label">Tags</div>
          </div>
        <% } %> -->
  
        <% if (entry.rating && entry.rating_over) { %>
          <div class="stat-card">
            <div class="stat-number"><%= entry.rating %> / <%= entry.rating_over %></div>
            <div class="stat-label"><%= t("rating") %></div>
          </div>
        <% } %>
  
        <% if (entry.clear_time) { %>
          <div class="stat-card">
            <div class="stat-number"><%= entry.clear_time %>h</div>
            <div class="stat-label"><%= t("clear_time") %></div>
          </div>
        <% } %>
    </div>
  </div>

  <div class="entry-review">
    <h4> <%= t("review") %> :</h4><br>
    <%- entry.review.replace(/\n/g, "<br>") %>
  </div>

  <div class="entry-review comment-box">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <h4> <%= t("comments") %> :</h4>
      <div class="notify" style="display: none;"></div>
    </div>
    <hr>
    <% entry.comments.forEach(comment => { %> 
      <div class="comment">
        <p><%= comment.content %></p>
        <small><%= comment.created_at.toLocaleString("fr-FR") %> | <%= t("by") %> <span style="color: <%= comment.userColor %>;"><%= comment.username %></span></small>
      </div>
      <% }) %>
      <form method="POST" action="/media/<%= entry.id %>/comment" id="comment-form">
        <% if (userId) { %>
          <hr>
          <input type="text" id="comment-input" name="comment" placeholder="<%= t("comment") %>" required>
          <button type="submit"><%= t("send") %></button>
        <% } %>
    </form>
    <% if(isAdmin) { %>
      <div>
        <button style="width: 100%; margin-top: 20px;" onclick='location.href="/media/<%= entry.id %>/edit"'><%= t("edit_media_entry") %></button>
      </div>
    <% } %>
  </div>

  <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
  <script>
    const socket = io();

    const form = document.getElementById("comment-form");
    const entryId = parseInt(document.getElementById("entryId").value);

    if (form) {
      form.addEventListener("submit", () => {
        // emit BEFORE page reload
        socket.emit("comment", entryId);
      });
    }

    socket.on("comment", (incomingEntryId) => {
      if (incomingEntryId === entryId) {
        document.querySelector(".notify").style.display = "block";
      }
    });
  </script>

</div>
